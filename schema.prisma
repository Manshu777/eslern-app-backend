generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  STUDENT
  ADMIN
}

model User {
  id            Int               @id @default(autoincrement())
  name          String?
  email         String            @unique
  phone         String?           @unique
  password      String
  role          Role              @default(STUDENT)
  selectedExams UserSelectedExam[]
  attempts      StudentAttempt[]
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
}

model UserSelectedExam {
  id     Int  @id @default(autoincrement())
  userId Int
  examId Int

  user   User @relation(fields: [userId], references: [id])
  exam   Exam @relation(fields: [examId], references: [id])
}

model Exam {
  id             Int                @id @default(autoincrement())
  name           String
  description    String?
  subjects       Subject[]
  studyMaterials StudyMaterial[]
  previousPapers PreviousYearPaper[]
  mockTests      MockTest[]
  users          UserSelectedExam[]
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt
}

model Subject {
  id        Int      @id @default(autoincrement())
  examId    Int
  name      String
  exam      Exam     @relation(fields: [examId], references: [id])

  materials StudyMaterial[]
  papers    PreviousYearPaper[]
  mockTests MockTest[]
}

model StudyMaterial {
  id          Int     @id @default(autoincrement())
  examId      Int
  subjectId   Int
  title       String
  type        String
  description String?
  filePath    String?
  videoUrl    String?

  exam      Exam    @relation(fields: [examId], references: [id])
  subject   Subject @relation(fields: [subjectId], references: [id])
}

model PreviousYearPaper {
  id        Int     @id @default(autoincrement())
  examId    Int
  subjectId Int
  year      Int
  pdfPath   String

  exam      Exam    @relation(fields: [examId], references: [id])
  subject   Subject @relation(fields: [subjectId], references: [id])
}

model MockTest {
  id           Int                @id @default(autoincrement())
  examId       Int
  subjectId    Int
  title        String
  duration     Int
  totalMarks   Int                @default(0)
  negativeMark Float              @default(0)
  isPublished  Boolean            @default(false)

  exam      Exam     @relation(fields: [examId], references: [id])
  subject   Subject  @relation(fields: [subjectId], references: [id])
  questions MockTestQuestion[]
  attempts  StudentAttempt[]
}

model MockTestQuestion {
  id            Int      @id @default(autoincrement())
  mockTestId    Int
  question      String
  options       Json
  correctAnswer String
  marks         Int      @default(1)

  mockTest MockTest        @relation(fields: [mockTestId], references: [id])
  answers  AttemptAnswer[]
}

model StudentAttempt {
  id         Int              @id @default(autoincrement())
  userId     Int
  mockTestId Int
  score      Int              @default(0)
  correct    Int              @default(0)
  wrong      Int              @default(0)
  skipped    Int              @default(0)
  createdAt  DateTime         @default(now())

  user     User     @relation(fields: [userId], references: [id])
  mockTest MockTest @relation(fields: [mockTestId], references: [id])
  answers  AttemptAnswer[]
}

model AttemptAnswer {
  id            Int               @id @default(autoincrement())
  attemptId     Int
  questionId    Int
  selectedOption String?
  isCorrect     Boolean           @default(false)

  attempt  StudentAttempt   @relation(fields: [attemptId], references: [id])
  question MockTestQuestion @relation(fields: [questionId], references: [id])
}
